image: elixir:latest

#services:
#  - mysql:latest
#  - redis:latest
#  - postgres:latest

# Préparation de l'environnement avant de pouvoir effectuer les tests
before_script:
  - mix local.rebar --force
  - mix local.hex --force
  - mix deps.get

# Lance les différents tests, et vérifie si tout est OK
mix:
  tags:
    - docker
  script:
    - mix test --cover
    - MIX_ENV=prod mix release
  artifacts:
    paths:
      - _build/prod/rel/network

# Permet de servir un site static avec la documentation
pages:
  tags:
    - docker
  script:
    - mix docs
    - mv doc public
  artifacts:
    paths:
      - public
